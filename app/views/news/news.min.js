"use strict";angular.module("app.news",["ngRoute"]).config(["$routeProvider",function(a){a.when("/news",{templateUrl:"views/news/news.html",controller:"newsCtrl"})}]).controller("newsCtrl",["$scope","$http",function(a,b){a.title="news";b({url:backend+"/news",method:"GET",dataType:"json",data:"",headers:{"Content-Type":"application/json; charset=utf-8",page:1,pagesize:9000}}).success(function(e,c,f,d){a.news=e.allnews;a.search=""}).error(function(e,c,f,d){a.error=true})}]).config(["$routeProvider",function(a){a.when("/news/:slug",{templateUrl:"views/news/newsarticle.html",controller:"newsArticleCtrl"})}]).controller("newsArticleCtrl",["$scope","$http","$routeParams",function(b,e,d,a){function c(){e({url:backend+"/news/"+d.slug,method:"GET",dataType:"json",data:"",headers:{"Content-Type":"application/json; charset=utf-8",}}).success(function(h,f,i,g){b.title=h.article[0].title;b.article=h.article[0];b.comments=h.article[0].comments}).error(function(h,f,i,g){b.error=true})}c();b.comment=function(f){if(localStorage.getItem("user_auth")){var g=localStorage.getItem("user_auth");b.username=localStorage.getItem("user_auth").user_auth[0].username;g=JSON.parse(g).user_auth[0].username;e({url:backend+"/news/"+d.slug+"/comments",method:"POST",dataType:"json",data:"",headers:{"Content-Type":"application/json; charset=utf-8",text:f,author:g,token:localStorageService.get("user_auth").user_auth[0].token}}).success(function(j,h,k,i){c();b.message=""}).error(function(j,h,k,i){b.error=true})}else{console.error("not logged in")}}}]).config(["$routeProvider",function(a){a.when("/news/:slug/edit",{templateUrl:"views/news/newsArticleEditor.html",controller:"newsArticleEditorCtrl"})}]).controller("newsArticleEditorCtrl",["$scope","$http","$routeParams","toastr","$location","FileUploader","localStorageService",function(h,f,g,c,e,i,d,a){var b=g.slug;h.uploader=new i();h.uploader.url=backend+"/file";h.uploader.formData={news_id:0,event_id:-1,page_id:-1};h.tinymceOptions={onChange:function(j){},inline:false,plugins:"advlist autolink link image lists charmap print preview youtube rImage",toolbar:["undo redo | styleselect | bold italic | link image","youtube rImage | alignleft aligncenter alignright"],external_plugins:{rImage:local+"assets/js/rimage/plugin.js"},theme:"modern",skin:"light"};f({url:backend+"/news/"+b,method:"GET",dataType:"json",data:"",headers:{"Content-Type":"application/json; charset=utf-8",}}).success(function(l,j,m,k){h.editor={};h.editor.title=l.article[0].title;h.editor.content=l.article[0].text;console.log(l.article[0])}).error(function(l,j,m,k){h.error=true;Materialize.toast("Failed to fetch post",1000)});h.update=function(k){var m=h.editor.title;var l=h.editor.content;var j="admin";f({url:backend+"/news/"+b,method:"POST",dataType:"json",data:h.editor.content,headers:{"Content-Type":"application/json; charset=utf-8",title:m,permission:j,token:d.get("user_auth").user_auth[0].token}}).success(function(o,n,p){console.log(o);e.path("/news/"+b+"/edit");Materialize.toast("Post edit success",1000)}).error(function(o,n,p){Materialize.toast("Failed to update post",1000)})}}]).config(["$routeProvider",function(a){a.when("/admin/news/add",{templateUrl:"views/news/newsArticleEditor.html",controller:"newsArticleEditorNewCtrl"})}]).controller("newsArticleEditorNewCtrl",["$scope","$http","localStorageService","$routeParams","$location",function(a,g,e,d,b,f){a.title="News Article Editor";a.editor={};a.editor.title="example title";a.editor.content="<h1>title</h1><p>Hello</p>";a.tinymceOptions={onChange:function(h){},inline:false,plugins:"advlist autolink link image lists charmap print preview youtube rImage",toolbar:["undo redo | styleselect | bold italic | link image","youtube rImage | alignleft aligncenter alignright"],external_plugins:{rImage:local+"assets/js/rimage/plugin.js"},theme:"modern",skin:"light"};var c="";if(e.get("user_auth")){c=e.get("user_auth").user_auth[0].token}a.update=function(i){var k=a.editor.title;var j=a.editor.content;var h="admin";g({url:backend+"/news/",method:"POST",dataType:"json",headers:{"Content-Type":"application/json; charset=utf-8",title:k,permission:h,token:c},data:"'"+a.editor.content+"'"}).success(function(m,l,n){Materialize.toast("Post created successfully <a href=data",1000)}).error(function(m,l,n){Materialize.toast("Post Failed",1000)})}}]).config(["$routeProvider",function(a){a.when("/search/news/:search",{templateUrl:"views/news/newsSearchresult.html",controller:"newsSearchCtrl"})}]).controller("newsSearchCtrl",["$scope","$http","$routeParams","$location",function(a,e,c,b,d){e({url:backend+"/search/news",method:"GET",dataType:"json",headers:{"Content-Type":"application/json; charset=utf-8",searchtext:c.search},}).success(function(g,f,h){if(g.news.length===0){a.found=false}else{a.found=true}a.news=g.news}).error(function(g,f,h){Materialize.toast("Post Failed",1000)})}]);